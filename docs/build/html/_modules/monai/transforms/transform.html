
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>monai.transforms.transform &#8212; MONAI 0.6.0 Documentation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../../index.html">
  <img src="../../../_static/MONAI-logo-color.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../whatsnew.html">
  Whatâ€™s New
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../highlights.html">
  Modules Overview
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../api.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../installation.html">
  Installation Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../contrib.html">
  Development
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/Project-MONAI/tutorials">Tutorials<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/project-monai/monai" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/projectmonai" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for monai.transforms.transform</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2020 - 2021 MONAI Consortium</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A collection of generic interfaces for MONAI transforms.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">monai</span> <span class="kn">import</span> <span class="n">transforms</span>
<span class="kn">from</span> <span class="nn">monai.config</span> <span class="kn">import</span> <span class="n">KeysCollection</span>
<span class="kn">from</span> <span class="nn">monai.utils</span> <span class="kn">import</span> <span class="n">MAX_SEED</span><span class="p">,</span> <span class="n">ensure_tuple</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ThreadUnsafe&quot;</span><span class="p">,</span> <span class="s2">&quot;apply_transform&quot;</span><span class="p">,</span> <span class="s2">&quot;Randomizable&quot;</span><span class="p">,</span> <span class="s2">&quot;RandomizableTransform&quot;</span><span class="p">,</span> <span class="s2">&quot;Transform&quot;</span><span class="p">,</span> <span class="s2">&quot;MapTransform&quot;</span><span class="p">]</span>

<span class="n">ReturnType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;ReturnType&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_apply_transform</span><span class="p">(</span>
    <span class="n">transform</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ReturnType</span><span class="p">],</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">unpack_parameters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReturnType</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform transformation `transform` with the provided parameters `parameters`.</span>

<span class="sd">    If `parameters` is a tuple and `unpack_items` is True, each parameter of `parameters` is unpacked</span>
<span class="sd">    as arguments to `transform`.</span>
<span class="sd">    Otherwise `parameters` is considered as single argument to `transform`.</span>

<span class="sd">    Args:</span>
<span class="sd">        transform (Callable[..., ReturnType]): a callable to be used to transform `data`.</span>
<span class="sd">        parameters (Any): parameters for the `transform`.</span>
<span class="sd">        unpack_parameters (bool, optional): whether to unpack parameters for `transform`. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ReturnType: The return type of `transform`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unpack_parameters</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="o">*</span><span class="n">parameters</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">apply_transform</span><span class="p">(</span>
    <span class="n">transform</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ReturnType</span><span class="p">],</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">map_items</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">unpack_items</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ReturnType</span><span class="p">],</span> <span class="n">ReturnType</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform `data` with `transform`.</span>

<span class="sd">    If `data` is a list or tuple and `map_data` is True, each item of `data` will be transformed</span>
<span class="sd">    and this method returns a list of outcomes.</span>
<span class="sd">    otherwise transform will be applied once with `data` as the argument.</span>

<span class="sd">    Args:</span>
<span class="sd">        transform (Callable[..., ReturnType]): a callable to be used to transform `data`.</span>
<span class="sd">        data (Any): an object to be transformed.</span>
<span class="sd">        map_items (bool, optional): whether to apply transform to each item in `data`,</span>
<span class="sd">            if `data` is a list or tuple. Defaults to True.</span>
<span class="sd">        unpack_items (bool, optional): [description]. Defaults to False.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: When ``transform`` raises an exception.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[List[ReturnType], ReturnType]: The return type of `transform` or a list thereof.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="n">map_items</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">_apply_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">unpack_items</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_apply_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unpack_items</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">transforms</span><span class="o">.</span><span class="n">compose</span><span class="o">.</span><span class="n">Compose</span><span class="p">):</span>
            <span class="c1"># log the input data information of exact transform in the transform chain</span>
            <span class="n">datastats</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">DataStats</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">value_range</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">datastats</span><span class="o">.</span><span class="n">_logger_name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Transform input info -- </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">_log_stats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Data&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)):</span>
                    <span class="c1"># log data type, shape, range for array</span>
                    <span class="n">datastats</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">data_shape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">value_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># log data type and value for other meta data</span>
                    <span class="n">datastats</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">data_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">_log_stats</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_log_stats</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;applying transform </span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>


<span class="k">class</span> <span class="nc">ThreadUnsafe</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to denote that the transform will mutate its member variables,</span>
<span class="sd">    when being applied. Transforms inheriting this class should be used</span>
<span class="sd">    cautiously in a multi-thread context.</span>

<span class="sd">    This type is typically used by :py:class:`monai.data.CacheDataset` and</span>
<span class="sd">    its extensions, where the transform cache is built with multiple threads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<div class="viewcode-block" id="Randomizable"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.Randomizable">[docs]</a><span class="k">class</span> <span class="nc">Randomizable</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">ThreadUnsafe</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An interface for handling random state locally, currently based on a class</span>
<span class="sd">    variable `R`, which is an instance of `np.random.RandomState`.  This</span>
<span class="sd">    provides the flexibility of component-specific determinism without</span>
<span class="sd">    affecting the global states.  It is recommended to use this API with</span>
<span class="sd">    :py:class:`monai.data.DataLoader` for deterministic behaviour of the</span>
<span class="sd">    preprocessing pipelines. This API is not thread-safe. Additionally,</span>
<span class="sd">    deepcopying instance of this class often causes insufficient randomness as</span>
<span class="sd">    the random states will be duplicated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">R</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>

<div class="viewcode-block" id="Randomizable.set_random_state"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.Randomizable.set_random_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_random_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Randomizable&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the random state locally, to control the randomness, the derived</span>
<span class="sd">        classes should use :py:attr:`self.R` instead of `np.random` to introduce random</span>
<span class="sd">        factors.</span>

<span class="sd">        Args:</span>
<span class="sd">            seed: set the random state with an integer seed.</span>
<span class="sd">            state: set the random state with a `np.random.RandomState` object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When ``state`` is not an ``Optional[np.random.RandomState]``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            a Randomizable instance.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_seed</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="k">else</span> <span class="n">seed</span>
            <span class="n">_seed</span> <span class="o">=</span> <span class="n">_seed</span> <span class="o">%</span> <span class="n">MAX_SEED</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">_seed</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;state must be None or a np.random.RandomState but is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">state</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Randomizable.randomize"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.Randomizable.randomize">[docs]</a>    <span class="k">def</span> <span class="nf">randomize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Within this method, :py:attr:`self.R` should be used, instead of `np.random`, to introduce random factors.</span>

<span class="sd">        all :py:attr:`self.R` calls happen here so that we have a better chance to</span>
<span class="sd">        identify errors of sync the random state.</span>

<span class="sd">        This method can generate the random factors based on properties of the input data.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: When the subclass does not override this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subclass </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> must implement this method.&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Transform"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.Transform">[docs]</a><span class="k">class</span> <span class="nc">Transform</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract class of a ``Transform``.</span>
<span class="sd">    A transform is callable that processes ``data``.</span>

<span class="sd">    It could be stateful and may modify ``data`` in place,</span>
<span class="sd">    the implementation should be aware of:</span>

<span class="sd">        #. thread safety when mutating its own states.</span>
<span class="sd">           When used from a multi-process context, transform&#39;s instance variables are read-only.</span>
<span class="sd">           thread-unsafe transforms should inherit :py:class:`monai.transforms.ThreadUnsafe`.</span>
<span class="sd">        #. ``data`` content unused by this transform may still be used in the</span>
<span class="sd">           subsequent transforms in a composed transform.</span>
<span class="sd">        #. storing too much information in ``data`` may not scale.</span>

<span class="sd">    See Also</span>

<span class="sd">        :py:class:`monai.transforms.Compose`</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Transform.__call__"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.Transform.__call__">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``data`` is an element which often comes from an iteration over an</span>
<span class="sd">        iterable, such as :py:class:`torch.utils.data.Dataset`. This method should</span>
<span class="sd">        return an updated version of ``data``.</span>
<span class="sd">        To simplify the input validations, most of the transforms assume that</span>

<span class="sd">        - ``data`` is a Numpy ndarray, PyTorch Tensor or string</span>
<span class="sd">        - the data shape can be:</span>

<span class="sd">          #. string data without shape, `LoadImage` transform expects file paths</span>
<span class="sd">          #. most of the pre-processing transforms expect: ``(num_channels, spatial_dim_1[, spatial_dim_2, ...])``,</span>
<span class="sd">             except that `AddChannel` expects (spatial_dim_1[, spatial_dim_2, ...]) and</span>
<span class="sd">             `AsChannelFirst` expects (spatial_dim_1[, spatial_dim_2, ...], num_channels)</span>
<span class="sd">          #. most of the post-processing transforms expect</span>
<span class="sd">             ``(batch_size, num_channels, spatial_dim_1[, spatial_dim_2, ...])``</span>

<span class="sd">        - the channel dimension is not omitted even if number of channels is one</span>

<span class="sd">        This method can optionally take additional arguments to help execute transformation operation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: When the subclass does not override this method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subclass </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> must implement this method.&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RandomizableTransform"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.RandomizableTransform">[docs]</a><span class="k">class</span> <span class="nc">RandomizableTransform</span><span class="p">(</span><span class="n">Randomizable</span><span class="p">,</span> <span class="n">Transform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An interface for handling random state locally, currently based on a class variable `R`,</span>
<span class="sd">    which is an instance of `np.random.RandomState`.</span>
<span class="sd">    This class introduces a randomized flag `_do_transform`, is mainly for randomized data augmentation transforms.</span>
<span class="sd">    For example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from monai.transforms import RandomizableTransform</span>

<span class="sd">        class RandShiftIntensity100(RandomizableTransform):</span>
<span class="sd">            def randomize(self):</span>
<span class="sd">                super().randomize(None)</span>
<span class="sd">                self._offset = self.R.uniform(low=0, high=100)</span>

<span class="sd">            def __call__(self, img):</span>
<span class="sd">                self.randomize()</span>
<span class="sd">                if not self._do_transform:</span>
<span class="sd">                    return img</span>
<span class="sd">                return img + self._offset</span>

<span class="sd">        transform = RandShiftIntensity()</span>
<span class="sd">        transform.set_random_state(seed=0)</span>
<span class="sd">        print(transform(10))</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">do_transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_transform</span> <span class="o">=</span> <span class="n">do_transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>

<div class="viewcode-block" id="RandomizableTransform.randomize"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.RandomizableTransform.randomize">[docs]</a>    <span class="k">def</span> <span class="nf">randomize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Within this method, :py:attr:`self.R` should be used, instead of `np.random`, to introduce random factors.</span>

<span class="sd">        all :py:attr:`self.R` calls happen here so that we have a better chance to</span>
<span class="sd">        identify errors of sync the random state.</span>

<span class="sd">        This method can generate the random factors based on properties of the input data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prob</span></div></div>


<div class="viewcode-block" id="MapTransform"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.MapTransform">[docs]</a><span class="k">class</span> <span class="nc">MapTransform</span><span class="p">(</span><span class="n">Transform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subclass of :py:class:`monai.transforms.Transform` with an assumption</span>
<span class="sd">    that the ``data`` input of ``self.__call__`` is a MutableMapping such as ``dict``.</span>

<span class="sd">    The ``keys`` parameter will be used to get and set the actual data</span>
<span class="sd">    item to transform.  That is, the callable of this transform should</span>
<span class="sd">    follow the pattern:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            def __call__(self, data):</span>
<span class="sd">                for key in self.keys:</span>
<span class="sd">                    if key in data:</span>
<span class="sd">                        # update output data with some_transform_function(data[key]).</span>
<span class="sd">                    else:</span>
<span class="sd">                        # raise exception unless allow_missing_keys==True.</span>
<span class="sd">                return data</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: When ``keys`` is an empty iterable.</span>
<span class="sd">        TypeError: When ``keys`` type is not in ``Union[Hashable, Iterable[Hashable]]``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="n">KeysCollection</span><span class="p">,</span> <span class="n">allow_missing_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensure_tuple</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_missing_keys</span> <span class="o">=</span> <span class="n">allow_missing_keys</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;keys must be non empty.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;keys must be one of (Hashable, Iterable[Hashable]) but is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MapTransform.__call__"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.MapTransform.__call__">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``data`` often comes from an iteration over an iterable,</span>
<span class="sd">        such as :py:class:`torch.utils.data.Dataset`.</span>

<span class="sd">        To simplify the input validations, this method assumes:</span>

<span class="sd">        - ``data`` is a Python dictionary</span>
<span class="sd">        - ``data[key]`` is a Numpy ndarray, PyTorch Tensor or string, where ``key`` is an element</span>
<span class="sd">          of ``self.keys``, the data shape can be:</span>

<span class="sd">          #. string data without shape, `LoadImaged` transform expects file paths</span>
<span class="sd">          #. most of the pre-processing transforms expect: ``(num_channels, spatial_dim_1[, spatial_dim_2, ...])``,</span>
<span class="sd">             except that `AddChanneld` expects (spatial_dim_1[, spatial_dim_2, ...]) and</span>
<span class="sd">             `AsChannelFirstd` expects (spatial_dim_1[, spatial_dim_2, ...], num_channels)</span>
<span class="sd">          #. most of the post-processing transforms expect</span>
<span class="sd">             ``(batch_size, num_channels, spatial_dim_1[, spatial_dim_2, ...])``</span>

<span class="sd">        - the channel dimension is not omitted even if number of channels is one</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: When the subclass does not override this method.</span>

<span class="sd">        returns:</span>
<span class="sd">            An updated dictionary version of ``data`` by applying the transform.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subclass </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> must implement this method.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MapTransform.key_iterator"><a class="viewcode-back" href="../../../transforms.html#monai.transforms.MapTransform.key_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">key_iterator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="o">*</span><span class="n">extra_iterables</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate across keys and optionally extra iterables. If key is missing, exception is raised if</span>
<span class="sd">        `allow_missing_keys==False` (default). If `allow_missing_keys==True`, key is skipped.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: data that the transform will be applied to</span>
<span class="sd">            extra_iterables: anything else to be iterated through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if no extra iterables given, create a dummy list of Nones</span>
        <span class="n">ex_iters</span> <span class="o">=</span> <span class="n">extra_iterables</span> <span class="k">if</span> <span class="n">extra_iterables</span> <span class="k">else</span> <span class="p">[[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">)]</span>

        <span class="c1"># loop over keys and any extra iterables</span>
        <span class="n">_ex_iters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">_ex_iters</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="o">*</span><span class="n">ex_iters</span><span class="p">):</span>
            <span class="c1"># all normal, yield (what we yield depends on whether extra iterables were given)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">key</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_ex_iters</span><span class="p">)</span> <span class="k">if</span> <span class="n">extra_iterables</span> <span class="k">else</span> <span class="n">key</span>
            <span class="c1"># if missing keys not allowed, raise</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_missing_keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key was missing (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">) and allow_missing_keys==False&quot;</span><span class="p">)</span></div></div>
</pre></div>

              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020 - 2021 MONAI Consortium.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>